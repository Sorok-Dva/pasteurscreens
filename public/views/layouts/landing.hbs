<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description"
          content="Paste your screenshots to upload it online for free with a short url for sharing !"/>
    <meta name="author" content="Llyam Garcia"/>

    <!-- meta facebook -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Paste Your Screens | Instant screenshots sharing">
    <meta property="og:description"
          content="Paste your screenshots to upload it online for free with a short url for sharing !"/>

    <title>Paste Your Screens | Instant screenshots sharing</title>

        <style>
            section {
                padding: 70px 0 !important;
            }
        </style>
        <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300i,400,700%7cMarcellus+SC" rel="stylesheet">
        <link rel="stylesheet" href="/assets/css/lux.min.css">
        <link rel="stylesheet" href="/assets/bower_components/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="/assets/bower_components/ionicons/css/ionicons.min.css">
        <link rel="stylesheet" href="/assets/css/jquery-ui/jquery-ui.min.css">
        <link rel="stylesheet" href="/assets/css/jquery-ui/jquery-ui.structure.min.css">
        <link rel="stylesheet" href="/assets/css/jquery-ui/jquery-ui.theme.min.css">
        <link rel="stylesheet" href="/assets/css//scrolling-nav.css">

        <script src="/assets/bower_components/tether/dist/js/tether.min.js"></script>
        <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="/assets/js/jquery-ui.min.js"></script>
        <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.js"></script>
    </head>

    <body>
        {{> header}}
        <header class="bg-primary text-white">
            <div class="container text-center">
                <h1 class="text-white">{{tr.layouts.landing.header_h1_text}}</h1>
                <p class="lead">{{tr.layouts.landing.header_lead_text}}</p>
            </div>
            <p>
                Focus this tab and press <kbd>CTRL</kbd> + <kbd>V</kbd>. The image on your clipboard will be rendered on the canvas !
            </p>
            <canvas style="border:1px solid grey;" id="mycanvas"></canvas>
        </header>

        <section id="about">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2>{{tr.layouts.landing.section_about_h2_text}}</h2>
                        <p class="lead">{{{tr.layouts.landing.section_about_h2_text_lead}}}</p>
                        <p>{{{tr.layouts.landing.section_about_p_text}}}</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="services" class="bg-light">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2>{{tr.layouts.landing.section_whoami_h2_text}}</h2>
                        <p class="lead">{{tr.layouts.landing.section_whoami_h2_text_lead}}</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h2>{{tr.layouts.landing.section_contact_h2_text}}</h2>
                        <p class="lead">{{{tr.layouts.landing.section_contact_h2_text_lead}}}</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="py-5 bg-dark">
            <div class="container">
                <p class="m-0 text-center text-white">Copyright &copy; Pasteurscreens.tk 2018</p>
            </div>
        </footer>
        <script>
            function retrieveImageFromClipboardAsBlob(pasteEvent, callback){
                if(pasteEvent.clipboardData == false){
                    if(typeof(callback) == "function"){
                        callback(undefined);
                    }
                };

                var items = pasteEvent.clipboardData.items;

                if(items == undefined){
                    if(typeof(callback) == "function"){
                        callback(undefined);
                    }
                };

                for (var i = 0; i < items.length; i++) {
                    // Skip content if not image
                    if (items[i].type.indexOf("image") == -1) continue;
                    // Retrieve image on clipboard as blob
                    var blob = items[i].getAsFile();

                    if(typeof(callback) == "function"){
                        callback(blob);
                    }
                }
            }

            $('body').bind('paste', function(e) {
                var data = e.originalEvent.clipboardData.items[0].getAsFile();
                var elem = this;
                var fr = new FileReader;

                fr.onloadend = function() {
                    var img = new Image;
                    img.onload = function() {
                        $(elem).append(img);
                    };
                    img.src = fr.result;
                    console.log(fr.result);
                    $.post('/screens/save', {base64: fr.result}, (data) => {
                        console.log(data);
                    })
                };

                fr.readAsDataURL(data);

            });
            window.addEventListener("paste", function(e){

                // Handle the event
                retrieveImageFromClipboardAsBlob(e, function(imageBlob){
                    // If there's an image, display it in the canvas
                    if(imageBlob){
                        var canvas = document.getElementById("mycanvas");
                        var ctx = canvas.getContext('2d');

                        // Create an image to render the blob on the canvas
                        var img = new Image();

                        // Once the image loads, render the img on the canvas
                        img.onload = function(){
                            // Update dimensions of the canvas with the dimensions of the image
                            canvas.width = this.width;
                            canvas.height = this.height;

                            // Draw the image
                            ctx.drawImage(img, 0, 0);
                        };

                        // Crossbrowser support for URL
                        var URLObj = window.URL || window.webkitURL;

                        // Creates a DOMString containing a URL representing the object given in the parameter
                        // namely the original Blob
                        img.src = URLObj.createObjectURL(imageBlob);
                        console.log(URLObj.createObjectURL(imageBlob));

                        var imgData = canvas.toDataURL();
                        console.log(imgData);
                    }
                });
            }, false);
        </script>
        {{> scripts }}
    </body>
</html>
