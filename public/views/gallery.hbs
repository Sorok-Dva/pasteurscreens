<style>
    .view-group {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: row;
        flex-direction: row;
        padding-left: 0;
        margin-bottom: 0;
    }
    .thumbnail {
        margin-bottom: 30px;
        padding: 0px;
        -webkit-border-radius: 0px;
        -moz-border-radius: 0px;
        border-radius: 0px;
    }

    .item.list-group-item {
        float: none;
        width: 100%;
        background-color: #fff;
        margin-bottom: 30px;
        -ms-flex: 0 0 100%;
        flex: 0 0 100%;
        max-width: 100%;
        padding: 0 1rem;
        border: 0;
    }
    .item.list-group-item .img-event {
        float: left;
        width: 30%;
    }

    .item.list-group-item .list-group-image {
        margin-right: 10px;
    }
    .item.list-group-item .thumbnail {
        margin-bottom: 0px;
        display: inline-block;
    }
    .item.list-group-item .caption {
        float: left;
        width: 70%;
        margin: 0;
    }

    .item.list-group-item:before, .item.list-group-item:after {
        display: table;
        content: " ";
    }

    .item.list-group-item:after {
        clear: both;
    }

    .imgFrame {
        -webkit-box-flex: 1;
        -moz-box-flex: 1;
        box-flex: 1;
        -webkit-flex: 1 1 auto;
        flex: 1 1 auto;
        padding: 10px;
        margin: 10px;
        text-align: center;
        cursor: pointer;
        height: 250px;
        overflow: auto
    }

    img {
        float:right;
        height:auto;
    }
</style>
<div class="container" style="margin-top: 75px;">
    <div class="row">
        <div class="col-lg-12 my-3">
            <div class="pull-right">
                <div class="btn-group">
                    <button class="btn btn-info" id="list">
                        List View
                    </button>
                    <button class="btn btn-danger" id="grid">
                        Grid View
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="products" class="row view-group">
        {{#each captures as |capture|}}
            <div class="item col-xs-4 col-lg-4" data-main-div="{{capture.shareKey}}">
                <div class="thumbnail card">
                    <div class="imgFrame center-block" onClick="return showScreen('{{capture.shareKey}}', {{capture.private}})">
                            <img class="img-thumbnail" src="{{capture.path}}" alt="" />
                    </div>
                    <div class="caption card-body">
                        <h5 class="group card-title inner list-group-item-heading">{{capture.title}}</h5>
                        <p class="group inner list-group-item-text">{{dateFormat capture.uploadAt "DD/MM/YYYY HH:mm:ss"}}</p>
                        <div class="row">
                            <div class="col-xs-12 col-md-12">
                                {{#ifCond capture.private '===' 1}}
                                    <button class="btn btn-sm btn-success" data-key="{{capture.shareKey}}" disabled>Set public</button>
                                {{else}}
                                    <button class="btn btn-sm btn-success copyShareLink"
                                            data-clipboard-text="https://purs.tk/-{{capture.shareKey}}">Copy Link</button>
                                    <button class="btn btn-sm btn-warning" data-key="{{capture.shareKey}}" disabled>Set private</button>
                                {{/ifCond}}
                                    <button class="btn btn-sm btn-danger"
                                            data-action="delete"
                                            data-key="{{capture.shareKey}}"
                                            onclick="return askDelete('{{capture.shareKey}}')">Delete
                                    </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</div>

<script src="/assets/js/clipboard.min.js"></script>
<script>
    let clipboard = new ClipboardJS('.copyShareLink');
    clipboard.on('success', e => {
        $.notify({
            icon: 'fa fa-check-circle',
            title: 'Url copied to your clipboard',
            message: ''
        },{
            type: 'success',
            allow_dismiss: true,
            newest_on_top: false,
            showProgressbar: false,
            placement: {
                from: 'bottom',
                align: 'left'
            },
            offset: 20,
            spacing: 10,
            z_index: 1031,
            delay: 1000,
            timer: 2500,
            animate: {
                enter: 'animated fadeInDown',
                exit: 'animated fadeOutUp'
            }
        });
        e.clearSelection();
    });
    let showScreen = (key, privacy) => {
        let url = privacy === 1 ? 'https://pasteurscreens.tk' : 'https://purs.tk';
        $(location).attr('href', `${url}/-${key}`);
    };

    let askDelete = (key) => {
        let deleteButton = $(`button[data-key="${key}"][data-action="delete"]`);
        deleteButton.html('Really ?').attr('onclick', `return deleteScreen('${key}');`);
        $(document).click(() => {
            if (!$(event.target).is("button")) {
                deleteButton.html('Delete').attr('onclick', `return askDelete('${key}');`)
            }
        });
    };

    let deleteScreen = (key) => {
      $.post(`/screens/delete/${key}`, result => {
        if (result.state === 'deleted') {
            $(`div[data-main-div="${key}"]`).fadeOut(300, () => $(this).remove());
        }
      });
    };

    $(document).ready(() => {
      let items = $('#products .item');
        $('#list').click(event => { event.preventDefault(); items.addClass('list-group-item');});
        $('#grid').click(event => { event.preventDefault(); items.removeClass('list-group-item'); items.addClass('grid-group-item');});
    });
</script>